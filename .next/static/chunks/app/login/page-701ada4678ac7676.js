(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{779:(e,n,r)=>{Promise.resolve().then(r.bind(r,6350))},6083:(e,n,r)=>{"use strict";r.d(n,{GoogleOAuthProvider:()=>t,j:()=>a});var o=r(2115);let l=(0,o.createContext)(null);function t(e){let{clientId:n,nonce:r,onScriptLoadSuccess:t,onScriptLoadError:s,children:a}=e,i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{nonce:n,onScriptLoadSuccess:r,onScriptLoadError:l}=e,[t,s]=(0,o.useState)(!1),a=(0,o.useRef)(r);a.current=r;let i=(0,o.useRef)(l);return i.current=l,(0,o.useEffect)(()=>{let e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.nonce=n,e.onload=()=>{var e;s(!0),null==(e=a.current)||e.call(a)},e.onerror=()=>{var e;s(!1),null==(e=i.current)||e.call(i)},document.body.appendChild(e),()=>{document.body.removeChild(e)}},[n]),t}({nonce:r,onScriptLoadSuccess:t,onScriptLoadError:s}),d=(0,o.useMemo)(()=>({clientId:n,scriptLoadedSuccessfully:i}),[n,i]);return o.createElement(l.Provider,{value:d},a)}let s={large:40,medium:32,small:20};function a(e){let{onSuccess:n,onError:r,useOneTap:t,promptMomentNotification:a,type:i="standard",theme:d="outline",size:u="large",text:c,shape:g,logo_alignment:m,width:h,locale:f,click_listener:p,containerProps:v,...w}=e,b=(0,o.useRef)(null),{clientId:x,scriptLoadedSuccessfully:y}=function(){let e=(0,o.useContext)(l);if(!e)throw Error("Google OAuth components must be used within GoogleOAuthProvider");return e}(),L=(0,o.useRef)(n);L.current=n;let k=(0,o.useRef)(r);k.current=r;let N=(0,o.useRef)(a);return N.current=a,(0,o.useEffect)(()=>{var e,n,r,o,l,s,a,v,j;if(y)return null==(r=null==(n=null==(e=null==window?void 0:window.google)?void 0:e.accounts)?void 0:n.id)||r.initialize({client_id:x,callback:e=>{var n,r,o;if(!(null==e?void 0:e.credential))return null==(n=k.current)?void 0:n.call(k);let{credential:l,select_by:t}=e;L.current({credential:l,clientId:null!=(o=null==(r=e)?void 0:r.clientId)?o:null==r?void 0:r.client_id,select_by:t})},...w}),null==(s=null==(l=null==(o=null==window?void 0:window.google)?void 0:o.accounts)?void 0:l.id)||s.renderButton(b.current,{type:i,theme:d,size:u,text:c,shape:g,logo_alignment:m,width:h,locale:f,click_listener:p}),t&&(null==(j=null==(v=null==(a=null==window?void 0:window.google)?void 0:a.accounts)?void 0:v.id)||j.prompt(N.current)),()=>{var e,n,r;t&&(null==(r=null==(n=null==(e=null==window?void 0:window.google)?void 0:e.accounts)?void 0:n.id)||r.cancel())}},[x,y,t,i,d,u,c,g,m,h,f]),o.createElement("div",{...v,ref:b,style:{height:s[u],...null==v?void 0:v.style}})}},6350:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>f});var o=r(5155),l=r(2115),t=r(5695),s=r(2945),a=r(5933);function i(){let e=(0,a._)(["\nmutation Login($args: LoginArgs) {\n  Login(args: $args) {\n    status\n    message\n    token\n    user {\n      id\n      Fname\n      Mname\n      Lname\n      photo\n      email\n      role\n      password\n      warehouse {\n        id\n        capacity\n        email\n        address\n        location\n        managerId\n        name\n        phone\n      }\n    }\n  }\n}\n"]);return i=function(){return e},e}let d=(0,r(6112).J1)(i());var u=r(8543),c=r(6083);class g extends Error{}g.prototype.name="InvalidTokenError";var m=r(6874),h=r.n(m);function f(){let e=(0,t.useRouter)(),[n,r]=(0,l.useState)({email:"",password:""}),[a,i]=(0,l.useState)(!1),[m,f]=(0,l.useState)(!1),[p,{loading:v,error:w}]=(0,s.n)(d),b=e=>{let{name:n,value:o}=e.target;r(e=>({...e,[n]:o}))},x=async e=>{e.preventDefault(),await L()},y=n=>{"ADMINISTRATOR"===n.role?e.push("/admin-dashboard"):"WAREHOUSE_GUY"===n.role?e.push("/warehouse-dashboard"):"BUYER"===n.role?e.push("/buyer-dashboard"):e.push("/dashboard")},L=async()=>{if(!n.email||!n.password)return void u.oR.error("Please fill in all fields");f(!0);try{var r,o,l;let{data:t}=await p({variables:{args:{email:n.email.trim(),password:n.password}}});if(console.log("Login response:",t),(null==t||null==(r=t.Login)?void 0:r.status)==="Success"&&(null==t||null==(o=t.Login)?void 0:o.token))localStorage.setItem("token",t.Login.token),t.Login.user?(localStorage.setItem("user",JSON.stringify(t.Login.user)),u.oR.success(t.Login.message||"Login successful!"),y(t.Login.user)):e.push("/dashboard");else throw Error((null==t||null==(l=t.Login)?void 0:l.message)||"Login failed: Invalid response from server.")}catch(e){console.error("Login error:",e),e.message?u.oR.error(e.message):u.oR.error("An error occurred during login")}finally{f(!1)}},k=async n=>{f(!0);try{if(n.credential){var r,o,l;let t=function(e,n){let r;if("string"!=typeof e)throw new g("Invalid token specified: must be a string");n||(n={});let o=+(!0!==n.header),l=e.split(".")[o];if("string"!=typeof l)throw new g(`Invalid token specified: missing part #${o+1}`);try{r=function(e){let n=e.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=n,decodeURIComponent(atob(r).replace(/(.)/g,(e,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return atob(n)}}(l)}catch(e){throw new g(`Invalid token specified: invalid base64 for part #${o+1} (${e.message})`)}try{return JSON.parse(r)}catch(e){throw new g(`Invalid token specified: invalid json for part #${o+1} (${e.message})`)}}(n.credential).email;if(!t)return void u.oR.error("Google login failed: No email found");let{data:s}=await p({variables:{args:{email:t,password:""}}});if((null==s||null==(r=s.Login)?void 0:r.status)==="Success"&&(null==s||null==(o=s.Login)?void 0:o.token))localStorage.setItem("token",s.Login.token),s.Login.user&&localStorage.setItem("user",JSON.stringify(s.Login.user)),u.oR.success(s.Login.message||"Welcome back!"),s.Login.user?y(s.Login.user):e.push("/dashboard");else throw Error((null==s||null==(l=s.Login)?void 0:l.message)||"Google login failed")}else u.oR.error("Google login failed: No credential received")}catch(e){console.error("Google Login Error:",e),e.message.includes("Google Sign-In")?u.oR.error("This account is linked to Google. Please use Google sign-in."):e.message.includes("No account found")?u.oR.error("No account found. Please sign up first."):u.oR.error(e.message||"Google login failed")}finally{f(!1)}},N=v||m;return(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#476869] p-4",children:(0,o.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 space-y-6 animate-fade-in",children:[(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("h2",{className:"text-3xl font-bold text-[#205D5A]",children:"Welcome Back"}),(0,o.jsx)("p",{className:"text-gray-600 mt-2",children:"Log in to continue to the Marketplace."})]}),w&&(0,o.jsx)("div",{className:"p-3 bg-red-100 border border-red-400 text-red-700 rounded-xl text-center",children:w.message}),(0,o.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,o.jsx)("div",{children:(0,o.jsx)("input",{name:"email",type:"email",placeholder:"Email Address",value:n.email,onChange:b,required:!0,disabled:N,className:"w-full p-3 border-2 rounded-xl border-[#00A79D] bg-white text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00A79D] transition disabled:bg-gray-100 disabled:cursor-not-allowed"})}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{name:"password",type:a?"text":"password",placeholder:"Password",value:n.password,onChange:b,required:!0,disabled:N,className:"w-full p-3 border-2 rounded-xl border-[#00A79D] bg-white text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00A79D] transition disabled:bg-gray-100 disabled:cursor-not-allowed pr-16"}),(0,o.jsx)("button",{type:"button",onClick:()=>{i(!a)},disabled:N,className:"absolute right-4 top-1/2 -translate-y-1/2 text-sm font-medium text-[#00A79D] hover:text-[#205D5A] transition disabled:text-gray-400",children:a?"Hide":"Show"})]}),(0,o.jsx)("button",{type:"submit",disabled:N,className:"w-full bg-[#00A79D] text-white py-3 rounded-xl hover:bg-[#205D5A] transition duration-300 font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed",children:N?"Logging in...":"Log In"})]}),(0,o.jsx)("div",{className:"flex justify-center",children:(0,o.jsx)(c.j,{size:"large",shape:"rectangular",theme:"outline",onSuccess:k,onError:()=>{u.oR.error("Google login failed")}})}),(0,o.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 font-medium",children:[(0,o.jsx)(h(),{href:"/reset-password",className:"text-[#BD011F] hover:underline transition",children:"Forgot password?"}),(0,o.jsx)(h(),{href:"/",className:"text-[#205D5A] hover:underline transition",children:"Create an account"})]})]})})}}},e=>{var n=n=>e(e.s=n);e.O(0,[543,244,980,687,441,684,358],()=>n(779)),_N_E=e.O()}]);